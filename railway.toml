# railway.toml — EmptyTruck Connect deployment config
# Deploy with: railway up

[build]
builder = "dockerfile"

# ─── BACKEND SERVICE ──────────────────────────────────────────────────────────
[[services]]
name = "backend"
dockerfile = "backend/Dockerfile"
dockerfileTarget = "production"

[services.deploy]
startCommand = "node src/server.js"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[services.variables]
NODE_ENV = "production"
PORT = "5000"

# ─── FRONTEND SERVICE ─────────────────────────────────────────────────────────
[[services]]
name = "frontend"
dockerfile = "frontend/Dockerfile"
dockerfileTarget = "production"

[services.deploy]
healthcheckPath = "/ping"
healthcheckTimeout = 10

# ─── BUILD ARGS ───────────────────────────────────────────────────────────────
[services.build]
buildArgs = { VITE_API_URL = "$RAILWAY_PUBLIC_DOMAIN/api" }
